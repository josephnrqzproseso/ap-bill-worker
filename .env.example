PORT=8080
LOG_LEVEL=info
WORKER_SHARED_SECRET=replace-me

# Runtime budget
RUN_BUDGET_MS=1500000
TIME_RESERVE_MS=25000

# Routing source
ROUTING_SOURCE=sheets
SHEETS_SPREADSHEET_ID=your-google-sheet-id
ROUTING_SHEET_NAME=ProjectRouting
VENDOR_RULES_SHEET_NAME=VendorRules

# Scan controls
DOCS_BATCH_LIMIT=50
PASS1_UNRENAMED_LIMIT=50
PASS2_MARKED_LIMIT=50
SCAN_UNRENAMED_PREFIX=BILL
PROCESSED_MARKER_PREFIX=BILL_OCR_PROCESSED|V1|
OCR_JOB_MARKER_PREFIX=BILL_OCR_JOB|V1|
PDF_OCR_MAX_PAGES=80
OCR_MIN_TEXT_LEN=40
VISION_LANG_HINTS=en,fil

# Gemini (create key at https://aistudio.google.com/apikey or GCP Console)
GEMINI_API_KEY=your-gemini-api-key-here
GEMINI_MODEL=gemini-3-pro-preview

# Odoo defaults
SOURCE_BASE_URL=https://your-odoo-instance.odoo.com
SOURCE_DB=your-database
SOURCE_LOGIN=your-email@example.com
SOURCE_PASSWORD=your-odoo-password
DEFAULT_EXPENSE_ACCOUNT_ID=

# GCS OCR staging and optional state storage
GCS_BUCKET=your-gcs-bucket
GCS_INPUT_PREFIX=ap-ocr/input
GCS_OUTPUT_PREFIX=ap-ocr/output
STATE_BUCKET=
STATE_PREFIX=AP_BILL_STATE_V1



# ===== set these (no real secrets - use placeholders or env vars) =====
$PROJECT_ID = "your-gcp-project-id"
$REGION = "asia-southeast1"
$SERVICE = "ap-bill-ocr-worker"
$SHEET_ID = "your-google-sheet-id"
$GCS_BUCKET = "your-gcs-bucket"
$NEW_GEMINI_KEY = "your-regenerated-gemini-api-key"
# =====================

# 1) Set project
gcloud config set project $PROJECT_ID

# 2) Add new Gemini key version to Secret Manager (after regenerating in GCP Console)
$NEW_GEMINI_KEY | gcloud secrets versions add gemini-api-key --data-file=- --project $PROJECT_ID

# 3) Redeploy Cloud Run (set env + secrets)
gcloud run deploy $SERVICE `
  --project $PROJECT_ID `
  --region $REGION `
  --image "asia-southeast1-docker.pkg.dev/$PROJECT_ID/ap-bill/ap-bill-ocr-worker:latest" `
  --service-account "ap-bill-worker@odoo-ocr-487104.iam.gserviceaccount.com" `
  --allow-unauthenticated `
  --port 8080 `
  --timeout 1800 `
  --set-env-vars "ROUTING_SOURCE=sheets,SHEETS_SPREADSHEET_ID=$SHEET_ID,GCS_BUCKET=$GCS_BUCKET,GEMINI_MODEL=gemini-2.5-pro" `
  --update-secrets "WORKER_SHARED_SECRET=worker-shared-secret:latest,GEMINI_API_KEY=gemini-api-key:latest"

# 4) Check health
$URL = gcloud run services describe $SERVICE --region $REGION --project $PROJECT_ID --format="value(status.url)"
$URL
Invoke-WebRequest "$URL/healthz" -UseBasicParsing

